---
config:
  theme: base
  themeVariables:
    primaryColor: '#ffffff'
    edgeLabelBackground: '#ffffff'
    tertiaryColor: '#f4f4f4'
    lineColor: '#455A64'
  layout: dagre
---
flowchart TB
    %% ==================================================
    %% [Process 1] ë°ì´í„° êµ¬ì¶•
    %% ==================================================
    subgraph Process_1["Process 1 : ë°ì´í„° êµ¬ì¶•"]
        direction TB

        %% ë…¸ë“œ ì •ì˜
        Building_GIS[/"ê±´ë¬¼ ë°ì´í„°"/]
        Scenario[/"í­ì—¼ ì‹œë‚˜ë¦¬ì˜¤<br>(íƒœì–‘ ê³ ë„ ë° ë°©ìœ„ê°)"/]
        Road_GIS[/"ë³´í–‰ë„ë¡œ ë°ì´í„°"/]

        Sim{"ê·¸ëŠ˜<br>ì‹œë®¬ë ˆì´ì…˜"}
        Poly["ê·¸ëŠ˜<br>Polygon"]
        Spatial_Join{"ê³µê°„ ì¡°ì¸<br>(Overlay)"}
        
        Link_DB[("Link<br>ì†ì„± DB")]
        note_db["Table Schema:<br>- Link_ID<br>- Shadow_Ratio<br>- Safety_Flag"]
    end

    %% ==================================================
    %% [Process 2] ì„œë¹„ìŠ¤ ì‹¤í–‰
    %% ==================================================
    subgraph Process_2["Process 2 : ì„œë¹„ìŠ¤ ì‹¤í–‰"]
        direction TB

        %% ì…ë ¥ ì†ŒìŠ¤
        subgraph P2_Header [" "]
            direction TB
            User(["ì¶œë°œì§€/ëª©ì ì§€<br>ì„¤ì •"])
            Weather[/"ê¸°ìƒ API<br>(ì‹¤ì‹œê°„ / Demo)"/]
        end

        Condition{"ì¡°ê±´ í™•ì¸<br>(28Â°C ì´ìƒ & ë¹„ X)"}

        %% ì•Œê³ ë¦¬ì¦˜ (ë©”ì¸ ë¡œì§)
        subgraph Algorithm[" "]
            direction TB
            Engine["Cooling Path<br>íƒìƒ‰"]
            Filter["Filter:<br>ìµœë‹¨ì‹œê°„ ê¸°ì¤€<br>+14% ì´ë‚´"]
            Sort["Sort:<br>ê·¸ëŠ˜ ë¹„ìœ¨ ìˆœ"]
            Select["Select:<br>Top 1 ê²½ë¡œ"]
        end

        %% ì˜ˆì™¸ ì²˜ë¦¬
        Msg_Option["ì•ˆë‚´ ë©”ì‹œì§€<br>'ì§€ê¸ˆì€ ì¾Œì í•´ìš”/ë¹„ê°€ ì™€ìš”'<br>+<br>[ë²„íŠ¼: ê·¸ë˜ë„ ê·¸ëŠ˜ ê²½ë¡œ ë³´ê¸°]"]
        Normal_UI["ğŸ—º ì¼ë°˜ ì§€ë„ í™”ë©´<br>(ìµœë‹¨ ê²½ë¡œ)"]

        %% ê²°ê³¼ UI
        UI_Cooling["ë©”ì¸ í™”ë©´"]
        
        subgraph UI_Group[" "]
            direction LR
            Map_View["ì§€ë„ í‘œì‹œ:<br>ìµœì  Cooling Path"]
            KPI_Card["KPI ì¹´ë“œ:<br>ì‹œê°„ / ê·¸ëŠ˜ / ì•ˆì „"]
        end
        
        Action{"ë‹¤ë¥¸ ê²½ë¡œ ë³´ê¸°"}
        UI_Sub["ì „ì²´ ë¦¬ìŠ¤íŠ¸<br>(ìµœì  / ìµœë‹¨ / í°ê¸¸ìš°ì„ )"]
    end

    %% ==================================================
    %% ì—°ê²° ì •ë³´
    %% ==================================================
    %%P1 ë‚´ë¶€ ì—°ê²°
    Building_GIS & Scenario --> Sim
    Sim --> Poly
    Poly --> Spatial_Join
    Road_GIS --> Spatial_Join
    Spatial_Join --> Link_DB
    note_db -.- Link_DB

    %%P2 ë‚´ë¶€ ì—°ê²°
    User --> Condition
    Weather --> Condition
    
    %%Link_DBì™€ Engine ì—°ê²°
    Link_DB ==> Engine
    
    Condition --"Yes"--> Engine
    Condition --"No"--> Msg_Option

    Msg_Option --> Normal_UI
    Msg_Option -.-> |"Click"| Engine
    
    %%Engine ë‚´ë¶€ ì—°ê²°
    Engine --> Filter --> Sort --> Select
    Select --> UI_Cooling

    UI_Cooling --> UI_Group
    UI_Cooling --> Action
    Action --"Yes"--> UI_Sub

    %% ==================================================
    %% ìŠ¤íƒ€ì¼ ì •ì˜
    %% ==================================================
    classDef default fill:#fff,stroke:#CFD8DC,stroke-width:2px,rx:5,ry:5
    classDef transparent fill:none,stroke:none
    
    classDef input fill:#FFF9C4,stroke:#FBC02D,stroke-width:2px,color:#E65100
    classDef db fill:#E1F5FE,stroke:#0277BD,stroke-width:2px,stroke-dasharray: 5 5,color:#01579B
    
    classDef user fill:#ffffff,stroke:#EF6C00,stroke-width:3px,color:#E65100
    classDef api fill:#E8F5E9,stroke:#2E7D32,stroke-width:2px,color:#1B5E20
    
    classDef decision fill:#FFE0B2,stroke:#FB8C00,stroke-width:2px,color:#E65100
    classDef alert fill:#FFEBEE,stroke:#EF5350,stroke-width:2px,color:#B71C1C
    classDef ui_gray fill:#78909C,stroke:#546E7A,stroke-width:2px,color:#fff
    
    classDef logic fill:#E8F5E9,stroke:#43A047,stroke-width:2px,color:#1B5E20
    classDef ui_main fill:#37474F,stroke:#263238,stroke-width:2px,color:#fff

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ ì ìš©
    Building_GIS:::input
    Scenario:::input
    Road_GIS:::input
    Link_DB:::db
    
    GPS:::api
    User:::user
    Weather:::api
    
    Engine:::logic
    Filter:::logic
    Sort:::logic
    Select:::logic
    
    Map_View:::ui_main
    KPI_Card:::ui_main
    Condition:::decision
    Msg_Option:::alert
    Normal_UI:::ui_gray
    UI_Cooling:::ui_main
    
    UI_Group:::transparent
    P2_Header:::transparent

    %% ì˜ì—­(Subgraph) ìŠ¤íƒ€ì¼
    style Algorithm fill:#fff,stroke:#43A047,stroke-width:2px,stroke-dasharray: 5 5
    style Process_1 fill:#F5F7F9,stroke:#CFD8DC,stroke-width:1px, rx:10, ry:10
    style Process_2 fill:#FAFAFA,stroke:#B0BEC5,stroke-width:1px, rx:10, ry:10
